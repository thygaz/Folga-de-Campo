{% extends "base.html" %}

{% block styles %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style_index.css') }}">
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <div></div>
    <div class="d-flex align-items-center">
        <a href="/arquivados" class="btn btn-outline-secondary btn-sm"><i class="fas fa-archive me-1"></i> Lixeira</a>
    </div>
</div>

<div class="row g-3">
    <div class="col-md-3">
        <div class="card shadow-sm h-100 card-colaboradores border-0">
            <div class="card-header bg-white fw-bold border-bottom d-flex justify-content-between align-items-center">
                <span><i class="fas fa-users me-2"></i>Equipe</span>
                <button class="btn btn-sm btn-primary py-0" data-bs-toggle="modal" data-bs-target="#modalColab" title="Novo Colaborador">+</button>
            </div>
            
            <div id="external-events" class="list-group list-group-flush">
                <div class="p-2 bg-light small text-center text-muted border-bottom"><i class="fas fa-hand-pointer me-1"></i> Arraste para o calendário</div>
                <a href="#" class="list-group-item list-group-item-action active" onclick="filtrarColaborador('')"><strong>Ver Todos</strong></a>
                {% for d in dados %}
                <div class="list-group-item list-group-item-action fc-event-draggable" data-id="{{ d.id }}" data-title="{{ d.nome }}"> 
                    <div class="d-flex w-100 justify-content-between align-items-center">
                        <div onclick="filtrarColaborador('{{ d.id }}', this.parentElement.parentElement)" style="flex-grow: 1;">
                            <span class="fw-bold d-block text-truncate">{{ d.nome }}</span>
                            <small class="text-muted">{{ d.dias }}d trab.</small>
                        </div>
                        <button class="btn btn-link text-danger p-0 ms-2 opacity-50 hover-opacity-100" onclick="arquivarColaborador('{{ d.id }}', '{{ d.nome }}')"><i class="fas fa-trash-alt"></i></button>
                    </div>
                    <div class="mt-1"><span class="badge {{ d.classe }} w-100 py-1">{{ d.status }}</span></div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <div class="col-md-9">
        <div class="card shadow-sm border-0 h-100 card-calendario">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="fw-bold text-dark mb-0">Visão Geral</h4>
                    <div>
                        <a href="/timeline" class="btn btn-outline-dark me-2"><i class="fas fa-expand-arrows-alt me-1"></i> Timeline (Tela Cheia)</a>
                        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalFolga"><i class="fas fa-plus-circle me-2"></i>Lançar</button>
                    </div>
                </div>
                <div id="calendar"></div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalColab" tabindex="-1">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header"><h5 class="modal-title">Novo Colaborador</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
            <div class="modal-body">
                <form action="/api/novo_colaborador" method="POST">
                    <input type="text" name="nome" class="form-control mb-2" placeholder="Nome Completo" required>
                    <button type="submit" class="btn btn-primary w-100">Salvar</button>
                </form>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modalFolga" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h5 class="modal-title">Lançar Folga Manual</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
            <div class="modal-body">
                <form id="formFolga">
                    <div class="mb-3"><label>Colaborador</label>
                        <select class="form-select" id="colaboradorSelect" required>
                            <option value="">Selecione...</option>
                            {% for c in colaboradores %}<option value="{{ c.id }}">{{ c.nome }}</option>{% endfor %}
                        </select>
                    </div>
                    <div class="row">
                        <div class="col-6 mb-3"><label>Início</label><input type="date" class="form-control" id="start" required></div>
                        <div class="col-6 mb-3"><label>Fim</label><input type="date" class="form-control" id="end" required></div>
                    </div>
                    <div class="text-end"><button type="button" class="btn btn-sm btn-outline-secondary" onclick="somarDias(11)">+11 Dias</button></div>
                </form>
            </div>
            <div class="modal-footer"><button type="button" class="btn btn-primary w-100" onclick="salvarFolga()">Salvar</button></div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://unpkg.com/@popperjs/core@2"></script>
<script src="https://unpkg.com/tippy.js@6"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src='https://cdn.jsdelivr.net/npm/fullcalendar-scheduler@6.1.10/index.global.min.js'></script>
<script>
    const API_EVENTOS = "{{ url_for('get_eventos') }}";
    const API_RECURSOS = "{{ url_for('get_recursos') }}";
</script>
<script src="{{ url_for('static', filename='js/script_index.js') }}"></script>
{% endblock %}